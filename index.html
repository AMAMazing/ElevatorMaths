<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mental Math Trainer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-tap-highlight-color: transparent; /* Remove tap flash on mobile */
        }
        /* Feedback transition */
        #feedback-container.hidden {
            opacity: 0;
            transform: translateY(10px);
            max-height: 0;
            padding-top: 0;
            padding-bottom: 0;
            margin-top: 0;
        }
        #feedback-container {
            opacity: 1;
            transform: translateY(0);
            max-height: 100px; /* Adjust as needed */
            transition: all 0.3s ease-in-out;
            margin-top: 1rem; /* mt-4 */
        }
    </style>
</head>
<body class="bg-gray-900 text-white flex items-center justify-center min-h-screen p-4">

    <main class="w-full max-w-md mx-auto">
        <div id="card" class="bg-gray-800 rounded-2xl shadow-2xl p-6 md:p-8 min-h-[350px] flex flex-col justify-between">
            
            <!-- Header: Level & Streak -->
            <header class="flex justify-between items-center mb-6">
                <span id="level-el" class="text-xl font-bold text-indigo-400">Level 1</span>
                <span id="streak-el" class="text-lg font-medium text-green-400">Streak: 0</span>
            </header>

            <!-- Problem Area -->
            <div class="text-center flex-grow flex flex-col items-center justify-center">
                <div id="problem-container" class="text-4xl md:text-5xl font-bold text-white min-h-[100px] flex items-center justify-center">
                    <!-- Problem will be injected here -->
                </div>
            </div>

            <!-- Feedback Area (shown on submit) -->
            <div id="feedback-container" class="hidden text-center text-xl font-medium p-4 rounded-lg">
                <!-- Feedback: "Correct!" or "Incorrect. Answer: 42" -->
            </div>

            <!-- Answer Form -->
            <form id="answer-form" class="mt-8">
                <input type="text" id="answer-input" inputmode="numeric" pattern="[0-9.-]*"
                       class="w-full text-center text-3xl font-bold p-4 rounded-lg bg-gray-700 text-white border-2 border-gray-600 focus:border-indigo-400 focus:ring-2 focus:ring-indigo-400 outline-none transition duration-200"
                       placeholder="Your Answer" required autocomplete="off">
                
                <button type="submit" id="submit-btn"
                        class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 px-6 rounded-lg text-lg shadow-lg transition duration-200 mt-4">
                    Submit
                </button>
            </form>

        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // DOM Elements
            const levelEl = document.getElementById('level-el');
            const streakEl = document.getElementById('streak-el');
            const problemEl = document.getElementById('problem-container');
            const feedbackContainer = document.getElementById('feedback-container');
            const answerForm = document.getElementById('answer-form');
            const answerInput = document.getElementById('answer-input');
            const submitBtn = document.getElementById('submit-btn');

            // App State
            let state = {
                level: 1,
                streak: 0,
                currentProblem: null,
                isSubmitting: false, // Prevent double-submit
            };

            const STATE_KEY = 'mentalMathState';

            // --- Core Logic ---

            /**
             * Generates a random integer between min and max (inclusive)
             */
            function rand(min, max) {
                return Math.floor(Math.random() * (max - min + 1)) + min;
            }

            /**
             * Generates a problem object { question, answer } based on the level
             */
            function generateProblem(level) {
                let q = '';
                let a = ''; // Answer will always be a string for comparison

                switch (level) {
                    case 1: // Basic Arithmetic
                        {
                            const op = rand(1, 4);
                            if (op === 1) { // Addition
                                const aVal = rand(10, 99);
                                const bVal = rand(10, 99);
                                q = `${aVal} + ${bVal}`;
                                a = `${aVal + bVal}`;
                            } else if (op === 2) { // Subtraction
                                const aVal = rand(20, 100);
                                const bVal = rand(10, aVal - 5);
                                q = `${aVal} - ${bVal}`;
                                a = `${aVal - bVal}`;
                            } else if (op === 3) { // Multiplication
                                const aVal = rand(2, 12);
                                const bVal = rand(2, 12);
                                q = `${aVal} &times; ${bVal}`;
                                a = `${aVal * bVal}`;
                            } else { // Division
                                const bVal = rand(2, 12);
                                const ans = rand(2, 12);
                                const aVal = bVal * ans;
                                q = `${aVal} &divide; ${bVal}`;
                                a = `${ans}`;
                            }
                        }
                        break;

                    case 2: // Two-Step Arithmetic
                        {
                            const op = rand(1, 4);
                            if (op === 1) { // (a * b) + c
                                const aVal = rand(3, 12);
                                const bVal = rand(3, 12);
                                const cVal = rand(5, 25);
                                q = `(${aVal} &times; ${bVal}) + ${cVal}`;
                                a = `${aVal * bVal + cVal}`;
                            } else if (op === 2) { // a - (b * c)
                                const bVal = rand(3, 9);
                                const cVal = rand(3, 9);
                                const aVal = rand(bVal * cVal + 10, 150);
                                q = `${aVal} - (${bVal} &times; ${cVal})`;
                                a = `${aVal - (bVal * cVal)}`;
                            } else if (op === 3) { // a + (b / c)
                                const cVal = rand(2, 10);
                                const ans = rand(3, 10);
                                const bVal = cVal * ans;
                                const aVal = rand(10, 50);
                                q = `${aVal} + (${bVal} &divide; ${cVal})`;
                                a = `${aVal + ans}`;
                            } else { // a * (b - c)
                                const bVal = rand(10, 30);
                                const cVal = rand(2, bVal - 1);
                                const aVal = rand(2, 8);
                                q = `${aVal} &times; (${bVal} - ${cVal})`;
                                a = `${aVal * (bVal - cVal)}`;
                            }
                        }
                        break;

                    case 3: // Percentages & Fractions
                        {
                            const op = rand(1, 4);
                            if (op === 1) { // 10% of Y
                                const y = rand(10, 50) * 10;
                                q = `10% of ${y}`;
                                a = `${y * 0.1}`;
                            } else if (op === 2) { // Easy % of Y
                                const x = [20, 25, 50][rand(0, 2)];
                                const y = rand(5, 20) * (x === 25 ? 4 : 10);
                                q = `${x}% of ${y}`;
                                a = `${y * (x / 100)}`;
                            } else if (op === 3) { // Harder % of Y
                                const x = rand(11, 30);
                                const y = [100, 200, 300, 500][rand(0, 3)];
                                q = `${x}% of ${y}`;
                                a = `${y * (x / 100)}`;
                            } else { // (n/d) * num
                                const num = rand(3, 12) * 5;
                                const den = [4, 5, 10][rand(0, 2)];
                                const n = rand(1, den - 1);
                                q = `(<sup>${n}</sup>/<sub>${den}</sub>) &times; ${num}`;
                                a = `${(n / den) * num}`;
                            }
                        }
                        break;

                    case 4: // Basic Algebra
                        {
                            const op = rand(1, 4);
                            const x = rand(2, 10);
                            if (op === 1) { // ax + b = c
                                const aVal = rand(2, 5);
                                const bVal = rand(5, 20);
                                const cVal = aVal * x + bVal;
                                q = `${aVal}x + ${bVal} = ${cVal}<br><span class="text-2xl">x = ?</span>`;
                                a = `${x}`;
                            } else if (op === 2) { // ax = c
                                const aVal = rand(2, 10);
                                const cVal = aVal * x;
                                q = `${aVal}x = ${cVal}<br><span class="text-2xl">x = ?</span>`;
                                a = `${x}`;
                            } else if (op === 3) { // x / a = c
                                const cVal = rand(2, 10);
                                const aVal = rand(2, 10);
                                q = `x &divide; ${aVal} = ${cVal}<br><span class="text-2xl">x = ?</span>`;
                                a = `${aVal * cVal}`;
                            } else { // a(x + b) = c
                                const bVal = rand(2, 8);
                                const aVal = rand(2, 5);
                                const cVal = aVal * (x + bVal);
                                q = `${aVal}(x + ${bVal}) = ${cVal}<br><span class="text-2xl">x = ?</span>`;
                                a = `${x}`;
                            }
                        }
                        break;

                    case 5: // Sequences & Logic
                        {
                            const op = rand(1, 5);
                            if (op === 1) { // Arithmetic
                                const start = rand(1, 20);
                                const diff = rand(2, 15);
                                const seq = [start, start + diff, start + 2 * diff, start + 3 * diff];
                                q = `${seq.join(', ')}, ?`;
                                a = `${start + 4 * diff}`;
                            } else if (op === 2) { // Geometric
                                const start = rand(1, 5);
                                const ratio = rand(2, 5);
                                const seq = [start, start * ratio, start * ratio ** 2];
                                q = `${seq.join(', ')}, ?`;
                                a = `${start * ratio ** 3}`;
                            } else if (op === 3) { // Squares
                                const start = rand(2, 8);
                                const seq = [start ** 2, (start + 1) ** 2, (start + 2) ** 2];
                                q = `${seq.join(', ')}, ?`;
                                a = `${(start + 3) ** 2}`;
                            } else if (op === 4) { // Alternating (+a, -b)
                                const start = rand(10, 30);
                                const op1 = rand(3, 10);
                                const op2 = rand(1, op1 - 1);
                                const seq = [start, start + op1, start + op1 - op2, start + op1 - op2 + op1];
                                q = `${seq.join(', ')}, ?`;
                                a = `${start + op1 - op2 + op1 - op2}`;
                            } else { // Increasing diff
                                const start = rand(1, 5);
                                const d1 = rand(1, 3);
                                const seq = [start, start + d1, start + d1 + (d1 + 1), start + d1 + (d1 + 1) + (d1 + 2)];
                                q = `${seq.join(', ')}, ?`;
                                a = `${start + d1 + (d1 + 1) + (d1 + 2) + (d1 + 3)}`;
                            }
                        }
                        break;
                }

                return { question: q, answer: a };
            }

            /**
             * Updates header UI elements based on the current state
             */
            function updateHeaderUI() {
                levelEl.textContent = `Level ${state.level}`;
                streakEl.textContent = `Streak: ${state.streak}`;
            }

            /**
             * Generates the next problem, resets state, and updates UI
             */
            function nextProblem() {
                state.currentProblem = generateProblem(state.level);
                
                // Update UI
                updateHeaderUI();
                problemEl.innerHTML = state.currentProblem.question;
                
                // Reset form
                answerInput.value = '';
                feedbackContainer.classList.add('hidden');
                answerInput.disabled = false;
                submitBtn.disabled = false;
                state.isSubmitting = false;

                // Focus input for next problem
                answerInput.focus();
            }

            /**
             * Saves the current state (level and streak) to localStorage
             */
            function saveState() {
                const stateToSave = {
                    level: state.level,
                    streak: state.streak,
                };
                localStorage.setItem(STATE_KEY, JSON.stringify(stateToSave));
            }

            /**
             * Loads state from localStorage
             */
            function loadState() {
                const savedState = localStorage.getItem(STATE_KEY);
                if (savedState) {
                    const parsedState = JSON.parse(savedState);
                    state.level = parsedState.level || 1;
                    state.streak = parsedState.streak || 0;
                }
            }
            
            /**
             * Shows feedback to the user
             */
            function showFeedback(isCorrect, correctAnswer) {
                if (isCorrect) {
                    feedbackContainer.textContent = 'Correct!';
                    feedbackContainer.classList.remove('bg-red-900', 'text-red-200');
                    feedbackContainer.classList.add('bg-green-800', 'text-green-200');
                } else {
                    feedbackContainer.textContent = `Incorrect. The answer was ${correctAnswer}`;
                    feedbackContainer.classList.remove('bg-green-800', 'text-green-200');
                    feedbackContainer.classList.add('bg-red-900', 'text-red-200');
                }
                feedbackContainer.classList.remove('hidden');
            }

            /**
             * Handles the form submission
             */
            function handleSubmit(e) {
                e.preventDefault();
                if (state.isSubmitting) return;
                
                state.isSubmitting = true;
                answerInput.disabled = true;
                submitBtn.disabled = true;

                const userAnswer = answerInput.value.trim();
                const correctAnswer = state.currentProblem.answer;

                const isCorrect = userAnswer === correctAnswer;

                if (isCorrect) {
                    state.streak++;
                    if (state.streak >= 5) {
                        state.streak = 0;
                        state.level++;
                        if (state.level > 5) {
                            state.level = 1; // Loop back to level 1
                        }
                    }
                } else {
                    state.streak = 0;
                }

                showFeedback(isCorrect, correctAnswer);
                saveState();
                updateHeaderUI();

                // Load next problem after a delay
                setTimeout(() => {
                    nextProblem();
                }, isCorrect ? 1000 : 2000); // Shorter delay on correct, longer on incorrect
            }

            // --- Initialization ---
            
            loadState();
            nextProblem();

            answerForm.addEventListener('submit', handleSubmit);
        });
    </script>
</body>
</html>


